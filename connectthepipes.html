<html><head><title>Connect the Pipes</title><style>body{background-color:#eee;color:#222;display:flex;flex-direction:column;align-items:center;font-family:Arial,Helvetica,sans-serif;font-size:20px;line-height:1.3;user-select:none;padding-bottom:100px}.c-create-game{border:5px solid #666;background-color:#ccc;margin:10px;padding:5px 10px}#c{border:5px solid #888;touch-action:manipulation}</style><script type="text/javascript" src="data:text/javascript;base64,Ly8gaHR0cHM6Ly9naXRodWIuY29tL2tldnl1dS9yYXBpZC1xdWV1ZS9ibG9iL21hc3Rlci9zcmMvcXVldWUuanMKCmZ1bmN0aW9uIFF1ZXVlKGludGlhbENhcGFjaXR5KSB7Cgl2YXIgaGVhZCA9IDA7Cgl2YXIgdGFpbCA9IDA7Cgl2YXIgbGVuZ3RoID0gMDsKCXZhciBpbml0aWFsQ2FwYWNpdHkgPSBpbml0aWFsQ2FwYWNpdHk7Cgl2YXIgY3VycmVudFNpemUgPSAodHlwZW9mIGluaXRpYWxDYXBhY2l0eSA9PT0gdW5kZWZpbmVkKSA/IGluaXRpYWxDYXBhY2l0eSA6IDIwMDsKCXZhciBjb250YWluZXIgPSBbXTsKCWNvbnRhaW5lci5sZW5ndGg9Y3VycmVudFNpemU7CgoJZnVuY3Rpb24gZG91YmxpbmcoKSB7CgkJdmFyIGN1cnJlbnRTb3VyY2UgPSBoZWFkOwoJCXZhciBjdXJyZW50VGFyZ2V0ID0gMDsKCQl2YXIgbmV3Q29udGFpbmVyID0gW107CgkJbmV3Q29udGFpbmVyLmxlbmd0aCA9IDIqY3VycmVudFNpemU7CgoJCXdoaWxlIChjdXJyZW50VGFyZ2V0IDwgY3VycmVudFNpemUpIHsKCQkJbmV3Q29udGFpbmVyW2N1cnJlbnRUYXJnZXRdID0gY29udGFpbmVyW2N1cnJlbnRTb3VyY2VdOwoJCQljdXJyZW50U291cmNlKys7CgkJCWN1cnJlbnRUYXJnZXQrKzsKCQkJaWYgKGN1cnJlbnRTb3VyY2UgPT0gY3VycmVudFNpemUpIHsKCQkJCWN1cnJlbnRTb3VyY2UgPSAwOwoJCQl9CgkJfQoJCWNvbnRhaW5lciA9IG5ld0NvbnRhaW5lcjsKCQloZWFkID0gMDsKCQl0YWlsID0gY3VycmVudFNpemU7CgkJY3VycmVudFNpemUgKj0gMjsKCX0KCglmdW5jdGlvbiBzaHJpbmsoKSB7CgkJdmFyIGN1cnJlbnRTb3VyY2UgPSBoZWFkOwoJCXZhciBjdXJyZW50VGFyZ2V0ID0gMDsKCQl2YXIgbmV3Q29udGFpbmVyID0gW107CgkJbmV3Q29udGFpbmVyLmxlbmd0aCA9IGN1cnJlbnRTaXplLzQ7CgoJCXdoaWxlIChjdXJyZW50VGFyZ2V0IDwgY3VycmVudFNpemUpIHsKCQkJbmV3Q29udGFpbmVyW2N1cnJlbnRUYXJnZXRdID0gY29udGFpbmVyW2N1cnJlbnRTb3VyY2VdOwoJCQljdXJyZW50U291cmNlKys7CgkJCWN1cnJlbnRUYXJnZXQrKzsKCQkJaWYgKGN1cnJlbnRTb3VyY2UgPT0gY3VycmVudFNpemUpIHsKCQkJCWN1cnJlbnRTb3VyY2UgPSAwOwoJCQl9CgkJfQoJCWNvbnRhaW5lciA9IG5ld0NvbnRhaW5lcjsKCQloZWFkID0gMDsKCQl0YWlsID0gY3VycmVudFNpemU7CgkJY3VycmVudFNpemUgLz0gNDsKCX0KCgl0aGlzLnB1c2ggPSBmdW5jdGlvbihlbGVtZW50KSB7CgkJaWYgKGxlbmd0aCA9PSBjdXJyZW50U2l6ZSkgewoJCQlkb3VibGluZygpOwoJCX0KCQljb250YWluZXJbdGFpbF0gPSBlbGVtZW50OwoJCWxlbmd0aCsrOwoJCXRhaWwrKzsKCQlpZiAodGFpbCA9PSBjdXJyZW50U2l6ZSkgewoJCQl0YWlsID0gMDsKCQl9Cgl9OwoKCXRoaXMucG9wID0gZnVuY3Rpb24oKSB7CgkJaWYgKGxlbmd0aCA9PT0gMCkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdG1wID0gY29udGFpbmVyW2hlYWRdOwoJCWhlYWQrKzsKCQlsZW5ndGgtLTsKCQlpZiAoaGVhZCA9PSBjdXJyZW50U2l6ZSkgewoJCQloZWFkID0gMDsKCQl9CgkJaWYgKGxlbmd0aCA9PSBjdXJyZW50U2l6ZSAvIDQgJiYgbGVuZ3RoID4gaW5pdGlhbENhcGFjaXR5KSB7CgkJCXNocmluaygpOwoJCX0KCQlyZXR1cm4gdG1wOwoJfTsKCgoJdGhpcy5mcm9udCA9IGZ1bmN0aW9uKCkgewoJCWlmIChsZW5ndGggPT09IDApIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJCXJldHVybiBjb250YWluZXJbaGVhZF07Cgl9OwoKCXRoaXMubGVuZ3RoID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGxlbmd0aDsKCX07CgoJdGhpcy5pc0VtcHR5ID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGxlbmd0aCA9PT0gMDsKCX07CgoJcmV0dXJuIHRoaXM7Cn0=" defer="defer"></script><script type="text/javascript" src="data:text/javascript;base64,bGV0IGlkSXRlciA9IDA7CgpjbGFzcyBQb2x5Z29uIHsKCXBvc2l0aW9uID0gWzAsIDBdOwoJc2lkZXMgPSAwOwoJc2lkZUxlbmd0aCA9IDA7Cglyb3RhdGlvbiA9IDA7Cgljb25uZWN0aW9ucyA9IFtdOwoJcGlwZXMgPSAwOwoJcGlwZXNSb3RhdGlvbiA9IDA7CglwaXBlc1JvdGF0aW9uRGlzcGxheSA9IDA7Cglkc3UgPSB7IHJvb3Q6IG51bGwsIHNpemU6IDEgfTsKCXNlYXJjaCA9IHsgdmlzaXRlZDogZmFsc2UsIGRlZ3JlZTogMCB9OwoJaWQgPSBpZEl0ZXI7Cglsb2NrZWQgPSBmYWxzZTsKCWxhc3RDYW52YXNVcGRhdGUgPSAwOwoJaGFzTGlnaHQgPSBmYWxzZTsKCWhhc0N5Y2xlID0gZmFsc2U7Cgljb25zdHJ1Y3RvcihzaWRlcyA9IDMsIHNpZGVMZW5ndGggPSAwLCBwb3NpdGlvbiA9IFswLCAwXSwgcm90YXRpb24gPSAwKSB7CgkJdGhpcy5zaWRlcyA9IHNpZGVzOwoJCXRoaXMuc2lkZUxlbmd0aCA9IHNpZGVMZW5ndGg7CgkJdGhpcy5wb3NpdGlvbiA9IFsuLi5wb3NpdGlvbl07CgkJdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uOwoJCXRoaXMuY29ubmVjdGlvbnMgPSBBcnJheShzaWRlcykuZmlsbChudWxsKTsKCQl0aGlzLmRzdS5yb290ID0gdGhpczsKCQlpZEl0ZXIrKzsKCQl0aGlzLmxhc3RDYW52YXNVcGRhdGUgPSBjdXJyZW50Q2FudmFzVXBkYXRlOwoJCXRoaXMuY29tcHV0ZVZlcnRpY2VzKCk7Cgl9CgoJYWRkQ29ubmVjdGlvbihpZHgpIHsKCQl0aGlzLnBpcGVzIHw9IDEgPDwgaWR4OwoJfQoJaGFzQ29ubmVjdGlvbihpZHgpIHsKCQlyZXR1cm4gKHRoaXMucGlwZXMgJiAoMSA8PCAoKGlkeCAtIHRoaXMucGlwZXNSb3RhdGlvbiArIHRoaXMuc2lkZXMpICUgdGhpcy5zaWRlcykpKSAhPT0gMDsKCX0KCgl2ZXJ0aWNlcyA9IFtdOwoJbWlkcHRzID0gW107Cgljb21wdXRlVmVydGljZXMoKSB7CgkJaWYgKHRoaXMudmVydGljZXMubGVuZ3RoKSByZXR1cm47CgkJY29uc3QgeCA9IHRoaXMucG9zaXRpb25bMF0sIHkgPSB0aGlzLnBvc2l0aW9uWzFdLCBhbmcgPSAyICogTWF0aC5QSSAvIHRoaXMuc2lkZXM7CgkJY29uc3QgbCA9IHRoaXMuc2lkZUxlbmd0aCAvIE1hdGguc2luKGFuZyAvIDIpIC8gMiAtIDIuNTsKCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2lkZXM7IGkrKykgewoJCQl0aGlzLnZlcnRpY2VzLnB1c2goWwoJCQkJbCAqIE1hdGguY29zKChpIC0gMC41KSAqIGFuZyArIHRoaXMucm90YXRpb24pICsgeCwKCQkJCWwgKiBNYXRoLnNpbigoMC41IC0gaSkgKiBhbmcgLSB0aGlzLnJvdGF0aW9uKSArIHkKCQkJXSk7CgkJfQoJCWZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaWRlczsgaSsrKSB7CgkJCXRoaXMubWlkcHRzLnB1c2goWwoJCQkJdGhpcy52ZXJ0aWNlc1tpXVswXSAvIDIgKyB0aGlzLnZlcnRpY2VzWyhpICsgMSkgJSB0aGlzLnNpZGVzXVswXSAvIDIsCgkJCQl0aGlzLnZlcnRpY2VzW2ldWzFdIC8gMiArIHRoaXMudmVydGljZXNbKGkgKyAxKSAlIHRoaXMuc2lkZXNdWzFdIC8gMiwKCQkJXSk7CgkJfQoJfQoJaXNDbGlja2VkKHgsIHkpIHsKCQlsZXQgdCA9IDA7CgkJZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpZGVzOyBpKyspIHsKCQkJY29uc3QgdjEgPSB0aGlzLnZlcnRpY2VzW2ldOwoJCQljb25zdCB2MiA9IHRoaXMudmVydGljZXNbKGkgKyAxKSAlIHRoaXMuc2lkZXNdOwoJCQlpZiAoeCA8IE1hdGgubWluKHYxWzBdLCB2MlswXSkgfHwgeCA+PSBNYXRoLm1heCh2MVswXSwgdjJbMF0pKSBjb250aW51ZTsKCQkJaWYgKHkgLSB2MVsxXSA8PSAodjJbMV0gLSB2MVsxXSkgLyAodjJbMF0gLSB2MVswXSkgKiAoeCAtIHYxWzBdKSkgdCsrOwoJCX0KCQlyZXR1cm4gKHQgJSAyKSA9PT0gMTsKCX0KCglwaXBlc1JvdGF0ZUNsb2Nrd2lzZSgpIHsKCQlpZiAodGhpcy5sb2NrZWQpIHJldHVybjsKCQl0aGlzLmxhc3RDYW52YXNVcGRhdGUgPSBjdXJyZW50Q2FudmFzVXBkYXRlOwoJCXRoaXMucGlwZXNSb3RhdGlvbiA9ICh0aGlzLnBpcGVzUm90YXRpb24gKyB0aGlzLnNpZGVzIC0gMSkgJSB0aGlzLnNpZGVzOwoJCWdhbWUuY2FsY0xpZ2h0KCk7Cgl9CglwaXBlc1JvdGF0ZUFudGljbG9ja3dpc2UoKSB7CgkJaWYgKHRoaXMubG9ja2VkKSByZXR1cm47CgkJdGhpcy5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQl0aGlzLnBpcGVzUm90YXRpb24gPSAodGhpcy5waXBlc1JvdGF0aW9uICsgMSkgJSB0aGlzLnNpZGVzOwoJCWdhbWUuY2FsY0xpZ2h0KCk7Cgl9Cgl1cGRhdGVQaXBlc1JvdGF0aW9uRGlzcGxheSgpIHsKCQlpZiAoTWF0aC5hYnModGhpcy5waXBlc1JvdGF0aW9uRGlzcGxheSAtIHRoaXMucGlwZXNSb3RhdGlvbikgPCAwLjI1KSB7CgkJCXRoaXMucGlwZXNSb3RhdGlvbkRpc3BsYXkgPSB0aGlzLnBpcGVzUm90YXRpb247CgkJCXJldHVybjsKCQl9CgkJdGhpcy5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQljb25zdCBhbnRpRGlzdCA9ICh0aGlzLnBpcGVzUm90YXRpb24gLSB0aGlzLnBpcGVzUm90YXRpb25EaXNwbGF5ICsgdGhpcy5zaWRlcykgJSB0aGlzLnNpZGVzOwoJCWNvbnN0IGRpc3QgPSAodGhpcy5zaWRlcyAtIGFudGlEaXN0KSAlIHRoaXMuc2lkZXM7CgkJaWYgKGRpc3QgPCBhbnRpRGlzdCkgewoJCQl0aGlzLnBpcGVzUm90YXRpb25EaXNwbGF5ICs9IHRoaXMuc2lkZXMgLSAwLjI1OwoJCX0gZWxzZSB7CgkJCXRoaXMucGlwZXNSb3RhdGlvbkRpc3BsYXkgKz0gMC4yNTsKCQl9CgkJdGhpcy5waXBlc1JvdGF0aW9uRGlzcGxheSA9IHRoaXMucGlwZXNSb3RhdGlvbkRpc3BsYXkgJSB0aGlzLnNpZGVzOwoJfQoKCWRzdV9maW5kKCkgewoJCXJldHVybiB0aGlzLmRzdS5yb290LmlkID09PSB0aGlzLmlkID8gdGhpcyA6IHRoaXMuZHN1LnJvb3QgPSB0aGlzLmRzdS5yb290LmRzdV9maW5kKCk7Cgl9Cglkc3VfdW5pb24ob3RoZXIpIHsKCQlpZiAodGhpcy5kc3VfZmluZCgpID09PSBvdGhlci5kc3VfZmluZCgpKSByZXR1cm47CgkJdGhpcy5kc3VfZmluZCgpLmRzdS5zaXplICs9IG90aGVyLmRzdV9maW5kKCkuZHN1LnNpemU7CgkJb3RoZXIuZHN1X2ZpbmQoKS5kc3Uucm9vdCA9IHRoaXMuZHN1X2ZpbmQoKTsKCX0KfQoKY2xhc3MgSG9sb2dyYW0gewoJcGFyZW50OwoJcG9zaXRpb24gPSBbMCwgMF07Cgljb25zdHJ1Y3RvcihwYXJlbnQsIHBvc2l0aW9uID0gWzAsIDBdKSB7CgkJdGhpcy5wYXJlbnQgPSBwYXJlbnQ7CgkJdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uOwoJCXRoaXMuY29tcHV0ZU93blZlcnRpY2VzKCk7Cgl9CgkKCXZlcnRpY2VzID0gW107Cgljb21wdXRlT3duVmVydGljZXMoKSB7CgkJaWYgKHRoaXMudmVydGljZXMubGVuZ3RoKSByZXR1cm47CgkJdGhpcy52ZXJ0aWNlcyA9IHRoaXMucGFyZW50LnZlcnRpY2VzLm1hcCgoW3gsIHldKSA9PiBbCgkJCXggKyB0aGlzLnBvc2l0aW9uWzBdIC0gdGhpcy5wYXJlbnQucG9zaXRpb25bMF0sCgkJCXkgKyB0aGlzLnBvc2l0aW9uWzFdIC0gdGhpcy5wYXJlbnQucG9zaXRpb25bMV0sCgkJXSk7Cgl9Cglpc0NsaWNrZWQoeCwgeSkgewoJCWxldCB0ID0gMDsKCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGFyZW50LnNpZGVzOyBpKyspIHsKCQkJY29uc3QgdjEgPSB0aGlzLnZlcnRpY2VzW2ldOwoJCQljb25zdCB2MiA9IHRoaXMudmVydGljZXNbKGkgKyAxKSAlIHRoaXMucGFyZW50LnNpZGVzXTsKCQkJaWYgKHggPCBNYXRoLm1pbih2MVswXSwgdjJbMF0pIHx8IHggPj0gTWF0aC5tYXgodjFbMF0sIHYyWzBdKSkgY29udGludWU7CgkJCWlmICh5IC0gdjFbMV0gPD0gKHYyWzFdIC0gdjFbMV0pIC8gKHYyWzBdIC0gdjFbMF0pICogKHggLSB2MVswXSkpIHQrKzsKCQl9CgkJcmV0dXJuICh0ICUgMikgPT09IDE7Cgl9Cn0=" defer="defer"></script><script type="text/javascript" src="data:text/javascript;base64,ZnVuY3Rpb24gc2h1ZmZsZShhcnJheSkgewoJbGV0IGN1cnJlbnRJbmRleCA9IGFycmF5Lmxlbmd0aCwgIHJhbmRvbUluZGV4OwoJd2hpbGUgKGN1cnJlbnRJbmRleCAhPSAwKSB7CgkJcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpOwoJCWN1cnJlbnRJbmRleC0tOwoJCVthcnJheVtjdXJyZW50SW5kZXhdLCBhcnJheVtyYW5kb21JbmRleF1dID0gW2FycmF5W3JhbmRvbUluZGV4XSwgYXJyYXlbY3VycmVudEluZGV4XV07Cgl9CgoJcmV0dXJuIGFycmF5Owp9Cgpjb25zdCBnYW1lID0gewoJYm9hcmQ6IG5ldyBNYXAoKSwKCXNvdXJjZTogbnVsbCwKCXdvbjogZmFsc2UsCgltYWtlV2luKCkgewoJCWdhbWUud29uID0gdHJ1ZTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2luLXRleHQiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQlmb3IgKGNvbnN0IFtfLCBwb2x5XSBvZiBnYW1lLmJvYXJkKSB7CgkJCXBvbHkubG9ja2VkID0gdHJ1ZTsKCQkJcG9seS5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQl9CgkJcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBhbGVydCgiWW91IHdvbiEiKSkpOwoJfSwKCWNhbGNMaWdodCgpIHsKCQljb25zdCBoYXNMaWdodCA9IG5ldyBNYXAoKTsKCQljb25zdCBoYXNDeWNsZSA9IG5ldyBNYXAoKTsKCQlmb3IgKGNvbnN0IFtrZXksIHBvbHldIG9mIGdhbWUuYm9hcmQpIHsKCQkJaWYgKHBvbHkgaW5zdGFuY2VvZiBIb2xvZ3JhbSkgY29udGludWU7CgkJCXBvbHkuc2VhcmNoLnZpc2l0ZWQgPSBmYWxzZTsKCQkJcG9seS5zZWFyY2guZGVncmVlID0gMDsKCQkJaGFzTGlnaHQuc2V0KGtleSwgcG9seS5oYXNMaWdodCk7CgkJCWhhc0N5Y2xlLnNldChrZXksIHBvbHkuaGFzQ3ljbGUpOwoJCQlwb2x5Lmhhc0xpZ2h0ID0gZmFsc2U7CgkJCXBvbHkuaGFzQ3ljbGUgPSBmYWxzZTsKCQl9CgkJY29uc3Qgbm9kZXMgPSBbXTsKCQlmdW5jdGlvbiBERlMoaSkgewoJCQljb25zdCBzdGFjayA9IFtpXTsKCQkJd2hpbGUgKHN0YWNrLmxlbmd0aCkgewoJCQkJY29uc3QgdSA9IHN0YWNrLnBvcCgpOwoJCQkJaWYgKCF1LnNlYXJjaC52aXNpdGVkKSB7CgkJCQkJbm9kZXMucHVzaCh1KTsKCQkJCQl1LnNlYXJjaC52aXNpdGVkID0gdHJ1ZTsKCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHUuc2lkZXM7IGkrKykgewoJCQkJCQljb25zdCB2ID0gdS5jb25uZWN0aW9uc1tpXTsKCQkJCQkJaWYgKCF2IHx8ICF1Lmhhc0Nvbm5lY3Rpb24oaSkpIGNvbnRpbnVlOwoJCQkJCQlpZiAoIXYuaGFzQ29ubmVjdGlvbih2LmNvbm5lY3Rpb25zLmluZGV4T2YodSkpKSBjb250aW51ZTsKCQkJCQkJdi5zZWFyY2guZGVncmVlKys7CgkJCQkJCWlmICghdi5zZWFyY2gudmlzaXRlZCkgewoJCQkJCQkJdi5oYXNMaWdodCA9IHRydWU7CgkJCQkJCQlzdGFjay5wdXNoKHYpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWdhbWUuc291cmNlLmhhc0xpZ2h0ID0gdHJ1ZTsKCQlERlMoZ2FtZS5zb3VyY2UpOwoJCWZvciAoY29uc3QgcG9seSBvZiBub2RlcykgewoJCQlwb2x5LnNlYXJjaC52aXNpdGVkID0gZmFsc2U7CgkJfQoJCWZ1bmN0aW9uIERGUzIoaSkgewoJCQljb25zdCBzdGFjayA9IFtpXTsKCQkJd2hpbGUgKHN0YWNrLmxlbmd0aCkgewoJCQkJY29uc3QgdSA9IHN0YWNrLnBvcCgpOwoJCQkJaWYgKCF1LnNlYXJjaC52aXNpdGVkKSB7CgkJCQkJdS5zZWFyY2gudmlzaXRlZCA9IHRydWU7CgkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB1LnNpZGVzOyBpKyspIHsKCQkJCQkJY29uc3QgdiA9IHUuY29ubmVjdGlvbnNbaV07CgkJCQkJCWlmICghdiB8fCAhdS5oYXNDb25uZWN0aW9uKGkpIHx8ICF2Lmhhc0xpZ2h0KSBjb250aW51ZTsKCQkJCQkJaWYgKCF2Lmhhc0Nvbm5lY3Rpb24odi5jb25uZWN0aW9ucy5pbmRleE9mKHUpKSB8fCB2LnNlYXJjaC52aXNpdGVkKSBjb250aW51ZTsKCQkJCQkJdi5zZWFyY2guZGVncmVlLS07CgkJCQkJCWlmICh2LnNlYXJjaC5kZWdyZWUgPT09IDEpIHN0YWNrLnB1c2godik7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWZvciAoY29uc3QgcG9seSBvZiBub2RlcykgewoJCQlpZiAocG9seS5zZWFyY2guZGVncmVlIDw9IDEgJiYgIXBvbHkuc2VhcmNoLnZpc2l0ZWQpIERGUzIocG9seSk7CgkJfQoJCWZvciAoY29uc3QgcG9seSBvZiBub2RlcykgewoJCQlpZiAocG9seS5zZWFyY2guZGVncmVlID4gMSkgcG9seS5oYXNDeWNsZSA9IHRydWU7CgkJfQoJCWxldCBhbGxMaXQgPSB0cnVlOwoJCWZvciAoY29uc3QgW2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQlpZiAocG9seSBpbnN0YW5jZW9mIEhvbG9ncmFtKSBjb250aW51ZTsKCQkJaWYgKCFwb2x5Lmhhc0xpZ2h0IHx8IHBvbHkuaGFzQ3ljbGUpIGFsbExpdCA9IGZhbHNlOwoJCQlpZiAoaGFzTGlnaHQuZ2V0KGtleSkgIT09IHBvbHkuaGFzTGlnaHQpIHBvbHkubGFzdENhbnZhc1VwZGF0ZSA9IGN1cnJlbnRDYW52YXNVcGRhdGU7CgkJCWlmIChoYXNDeWNsZS5nZXQoa2V5KSAhPT0gcG9seS5oYXNDeWNsZSkgcG9seS5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQl9CgkJaWYgKGFsbExpdCkgZ2FtZS5tYWtlV2luKCk7Cgl9LAoJZ2VuZXJhdGVGcm9tQm9hcmQoKSB7CgkJZ2FtZS53b24gPSBmYWxzZTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2luLXRleHQiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCWNvbnN0IE5PREVfUFJPQkFCSUxJVFkgPSAwLjA3OwoJCWNvbnN0IEVER0VfUFJPQkFCSUxJVFkgPSAwLjExOwoJCWNvbnN0IHF1ZXVlID0gbmV3IFF1ZXVlKCk7CgkJZm9yIChjb25zdCBbX2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQlpZiAocG9seSBpbnN0YW5jZW9mIEhvbG9ncmFtKSBjb250aW51ZTsKCQkJaWYgKE1hdGgucmFuZG9tKCkgPCBOT0RFX1BST0JBQklMSVRZIHx8IHBvbHkgPT09IGdhbWUuc291cmNlKSBxdWV1ZS5wdXNoKHBvbHkpOwoJCX0KCQlmb3IgKGNvbnN0IFtfa2V5LCBwb2x5XSBvZiBnYW1lLmJvYXJkKSB7CgkJCWlmIChwb2x5IGluc3RhbmNlb2YgSG9sb2dyYW0pIGNvbnRpbnVlOwoJCQlpZiAocG9seS5kc3Uucm9vdCAhPT0gcG9seSB8fCBwb2x5LmRzdS5zaXplID4gMSkgY29udGludWU7CgkJCXF1ZXVlLnB1c2gocG9seSk7CgkJCXdoaWxlIChxdWV1ZS5sZW5ndGgoKSkgewoJCQkJY29uc3QgdG9wID0gcXVldWUucG9wKCk7CgkJCQlsZXQgdmFsaWRDb25zID0gdG9wLmNvbm5lY3Rpb25zLm1hcCgob3RoZXIsIGlkeCkgPT4gW290aGVyLCBpZHhdKQoJCQkJCS5maWx0ZXIoY29uID0+IGNvblswXSAmJiBjb25bMF0uZHN1X2ZpbmQoKSAhPT0gdG9wLmRzdV9maW5kKCkpOwoJCQkJaWYgKCF2YWxpZENvbnMubGVuZ3RoKSBjb250aW51ZTsKCQkJCWlmIChxdWV1ZS5sZW5ndGggPT09IDAgfHwgdG9wID09PSBwb2x5KSB7IAoJCQkJCWxldCBybmcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENvbnMubGVuZ3RoKTsKCQkJCQl0b3AuYWRkQ29ubmVjdGlvbih2YWxpZENvbnNbcm5nXVsxXSk7CgkJCQkJdmFsaWRDb25zW3JuZ11bMF0uYWRkQ29ubmVjdGlvbih2YWxpZENvbnNbcm5nXVswXS5jb25uZWN0aW9ucy5pbmRleE9mKHRvcCkpOwoJCQkJCXRvcC5kc3VfdW5pb24odmFsaWRDb25zW3JuZ11bMF0pOwoJCQkJCXF1ZXVlLnB1c2godmFsaWRDb25zW3JuZ11bMF0pOwoJCQkJfQoJCQkJZm9yIChjb25zdCBjb24gb2YgdmFsaWRDb25zKSB7CgkJCQkJaWYgKE1hdGgucmFuZG9tKCkgPCBFREdFX1BST0JBQklMSVRZICYmIGNvblswXS5kc3VfZmluZCgpICE9PSB0b3AuZHN1X2ZpbmQoKSkgewoJCQkJCQl0b3AuYWRkQ29ubmVjdGlvbihjb25bMV0pOwoJCQkJCQljb25bMF0uYWRkQ29ubmVjdGlvbihjb25bMF0uY29ubmVjdGlvbnMuaW5kZXhPZih0b3ApKTsKCQkJCQkJdG9wLmRzdV91bmlvbihjb25bMF0pOwoJCQkJCQlxdWV1ZS5wdXNoKGNvblswXSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWlmIChnYW1lLnNvdXJjZS5kc3Uuc2l6ZSA9PT0gZ2FtZS5ib2FyZC5zaXplKSByZXR1cm47CgkJZnVuY3Rpb24gREZTKGkpIHsKCQkJY29uc3Qgc3RhY2sgPSBbaV07CgkJCXdoaWxlIChzdGFjay5sZW5ndGgpIHsKCQkJCWNvbnN0IHUgPSBzdGFjay5wb3AoKTsKCQkJCWlmICghdS5zZWFyY2gudmlzaXRlZCkgewoJCQkJCXUuc2VhcmNoLnZpc2l0ZWQgPSB0cnVlOwoJCQkJCWNvbnN0IG9yZGVyID0gc2h1ZmZsZShBcnJheS5mcm9tKEFycmF5KHUuc2lkZXMpLCAoXywgaSkgPT4gaSkpOwoJCQkJCWZvciAoY29uc3QgaSBvZiBvcmRlcikgewoJCQkJCQlpZiAodS5jb25uZWN0aW9uc1tpXSAmJiAhdS5jb25uZWN0aW9uc1tpXS5zZWFyY2gudmlzaXRlZCkgewoJCQkJCQkJc3RhY2sucHVzaCh1LmNvbm5lY3Rpb25zW2ldKTsKCQkJCQkJCWlmICh1LmRzdV9maW5kKCkgIT09IHUuY29ubmVjdGlvbnNbaV0uZHN1X2ZpbmQoKSkgewoJCQkJCQkJCXUuYWRkQ29ubmVjdGlvbihpKTsKCQkJCQkJCQl1LmNvbm5lY3Rpb25zW2ldLmFkZENvbm5lY3Rpb24odS5jb25uZWN0aW9uc1tpXS5jb25uZWN0aW9ucy5pbmRleE9mKHUpKTsKCQkJCQkJCQl1LmRzdV91bmlvbih1LmNvbm5lY3Rpb25zW2ldKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlERlMoZ2FtZS5zb3VyY2UpOwoJfSwKCWdlbmVyYXRlR2FtZSh0eXBlLCB4LCB5KSB7CgkJZXZlbnRzU3RhY2sgPSBbXTsKCQlldmVudHNTdGFja1B0ciA9IDA7CgkJZ2FtZS5ib2FyZCA9IG5ldyBNYXAoKTsKCQlCT0FSRF9UWVBFU1t0eXBlXS5nZW5lcmF0ZSh4LCB5KTsKCQlnYW1lLmdlbmVyYXRlRnJvbUJvYXJkKCk7CgkJZm9yIChjb25zdCBbXywgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQlwb2x5LnBpcGVzUm90YXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb2x5LnNpZGVzKTsKCQkJcG9seS5waXBlc1JvdGF0aW9uRGlzcGxheSA9IHBvbHkucGlwZXNSb3RhdGlvbjsKCQl9CgkJZ2FtZS5jYWxjTGlnaHQoKTsKCQlpbml0Qm9hcmQoKTsKCX0sCgltYWtlR2FtZUZyb21VSSgpIHsKCQljb25zdCB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJvYXJkLXR5cGUiKS52YWx1ZTsKCQljb25zdCB4ID0gTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3aWR0aCIpLnZhbHVlKTsKCQljb25zdCB5ID0gTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJoZWlnaHQiKS52YWx1ZSk7CgkJaWYgKHggPCAyIHx8IHggPiA5OSkgewoJCQlhbGVydCgiV2lkdGggbXVzdCBiZSBiZXR3ZWVuIDIgYW5kIDk5ISIpOwoJCQlyZXR1cm47CgkJfQoJCWlmICh5IDwgMiB8fCB5ID4gOTkpIHsKCQkJYWxlcnQoIkhlaWdodCBtdXN0IGJlIGJldHdlZW4gMiBhbmQgOTkhIik7CgkJCXJldHVybjsKCQl9CgkJZ2FtZS5nZW5lcmF0ZUdhbWUodHlwZSwgeCwgeSk7Cgl9Cn07Cgpjb25zdCBCT0FSRF9UWVBFUyA9IHsKCXNxdWFyZTogewoJCWdlbmVyYXRlKHgsIHkpIHsKCQkJY29uc3Qgc2lkZUxlbiA9IDM1OwoJCQlmb3IgKGxldCBpID0gMDsgaSA8IHg7IGkrKykgewoJCQkJZm9yIChsZXQgaiA9IDA7IGogPCB5OyBqKyspIHsKCQkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQkJaSAqIDFlNyArIGosCgkJCQkJCW5ldyBQb2x5Z29uKDQsIHNpZGVMZW4sIFsoaSArIDAuNSkgKiBzaWRlTGVuLCAoaiArIDAuNSkgKiBzaWRlTGVuXSkKCQkJCQkpOwoJCQkJfQoJCQl9CgkJCWdhbWUuc291cmNlID0gZ2FtZS5ib2FyZC5nZXQoTWF0aC5mbG9vcih4IC8gMikgKiAxZTcgKyBNYXRoLmZsb29yKHkgLyAyKSk7CgkJCWZvciAobGV0IGkgPSAwOyBpIDwgeDsgaSsrKSB7CgkJCQlmb3IgKGxldCBqID0gMDsgaiA8IHk7IGorKykgewoJCQkJCWNvbnN0IHBvbHkgPSBnYW1lLmJvYXJkLmdldChpICogMWU3ICsgaik7CgkJCQkJcG9seS5jb25uZWN0aW9uc1swXSA9IGdhbWUuYm9hcmQuZ2V0KChpICsgMSkgKiAxZTcgKyBqKTsKCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzFdID0gZ2FtZS5ib2FyZC5nZXQoaSAqIDFlNyArIChqIC0gMSkpOwoJCQkJCXBvbHkuY29ubmVjdGlvbnNbMl0gPSBnYW1lLmJvYXJkLmdldCgoaSAtIDEpICogMWU3ICsgaik7CgkJCQkJcG9seS5jb25uZWN0aW9uc1szXSA9IGdhbWUuYm9hcmQuZ2V0KGkgKiAxZTcgKyAoaiArIDEpKTsKCQkJCX0KCQkJfQoJCX0KCX0sCglzcXVhcmVXcmFwOiB7CgkJZ2VuZXJhdGUoeCwgeSkgewoJCQljb25zdCBzaWRlTGVuID0gMzU7CgkJCUJPQVJEX1RZUEVTLnNxdWFyZS5nZW5lcmF0ZSh4LCB5KTsKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB4OyBpKyspIHsKCQkJCWNvbnN0IHBvbHkxID0gZ2FtZS5ib2FyZC5nZXQoaSAqIDFlNyArICh5IC0gMSkpOwoJCQkJY29uc3QgcG9seTIgPSBnYW1lLmJvYXJkLmdldChpICogMWU3KTsKCQkJCXBvbHkxLmNvbm5lY3Rpb25zWzNdID0gcG9seTI7CgkJCQlwb2x5Mi5jb25uZWN0aW9uc1sxXSA9IHBvbHkxOwoJCQkJZ2FtZS5ib2FyZC5zZXQoImh4MSIgKyBpLnRvU3RyaW5nKCksIG5ldyBIb2xvZ3JhbShwb2x5MSwgWyhpICsgMC41KSAqIHNpZGVMZW4sIC0wLjUgKiBzaWRlTGVuXSkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoImh4MiIgKyBpLnRvU3RyaW5nKCksIG5ldyBIb2xvZ3JhbShwb2x5MiwgWyhpICsgMC41KSAqIHNpZGVMZW4sICh5ICsgMC41KSAqIHNpZGVMZW5dKSk7CgkJCX0KCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB5OyBpKyspIHsKCQkJCWNvbnN0IHBvbHkxID0gZ2FtZS5ib2FyZC5nZXQoKHggLSAxKSAqIDFlNyArIGkpOwoJCQkJY29uc3QgcG9seTIgPSBnYW1lLmJvYXJkLmdldChpKTsKCQkJCXBvbHkxLmNvbm5lY3Rpb25zWzBdID0gcG9seTI7CgkJCQlwb2x5Mi5jb25uZWN0aW9uc1syXSA9IHBvbHkxOwoJCQkJZ2FtZS5ib2FyZC5zZXQoImh5MSIgKyBpLnRvU3RyaW5nKCksIG5ldyBIb2xvZ3JhbShwb2x5MSwgWy0wLjUgKiBzaWRlTGVuLCAoaSArIDAuNSkgKiBzaWRlTGVuXSkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoImh5MiIgKyBpLnRvU3RyaW5nKCksIG5ldyBIb2xvZ3JhbShwb2x5MiwgWyh4ICsgMC41KSAqIHNpZGVMZW4sIChpICsgMC41KSAqIHNpZGVMZW5dKSk7CgkJCX0KCQl9Cgl9LAoJdHJpYW5nbGU6IHsKCQlnZW5lcmF0ZSh4LCB5KSB7CgkJCWNvbnN0IGtleUZyb20gPSAoeCwgeSkgPT4geC50b1N0cmluZygpICsgIl8iICsgeS50b1N0cmluZygpOwoJCQljb25zdCBzaWRlTGVuID0gNTA7CgkJCWNvbnN0IG1pZHB0UiA9IHNpZGVMZW4gLyBNYXRoLnNxcnQoMykgLyAyOwoJCQljb25zdCBkaWFtID0gc2lkZUxlbiAqIE1hdGguc3FydCgzKSAvIDI7CgkJCWZvciAobGV0IGogPSAwOyBqIDwgeTsgaisrKSB7CgkJCQljb25zdCBzdWJ0ciA9ICgoaiA9PT0geSAtIDEpICYmICh5ICUgMiA9PT0gMSkpID8gMSA6IDA7CgkJCQlmb3IgKGxldCBpID0gMCArIHN1YnRyOyBpIDwgMiAqIHggLSAxIC0gc3VidHI7IGkrKykgewoJCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCQlrZXlGcm9tKGksIGopLAoJCQkJCQluZXcgUG9seWdvbigzLCBzaWRlTGVuLAoJCQkJCQkJWyhpICsgMSkgKiBzaWRlTGVuIC8gMiwgaiAqIGRpYW0gKyBtaWRwdFIgKiAoMiAtIChpICsgaikgJSAyKV0sCgkJCQkJCQkoaSArIGopICUgMiA9PT0gMCA/IE1hdGguUEkgLyA2IDogLU1hdGguUEkgKiA1IC8gNgoJCQkJCQkpCgkJCQkJKTsKCQkJCX0KCQkJfQoJCQlnYW1lLnNvdXJjZSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeCAtIDEsIE1hdGguZmxvb3IoeSAvIDIpKSk7CgkJCWZvciAoY29uc3QgW2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQkJbGV0IFt4MSwgeTFdID0ga2V5LnNwbGl0KCJfIik7CgkJCQl4MSA9IHBhcnNlSW50KHgxLCAxMCk7CgkJCQl5MSA9IHBhcnNlSW50KHkxLCAxMCk7CgkJCQljb25zdCB0eXBlID0gKHkxICsgeDEpICUgMjsKCQkJCXBvbHkuY29ubmVjdGlvbnNbdHlwZV0gPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHgxICsgMSwgeTEpKTsKCQkJCXBvbHkuY29ubmVjdGlvbnNbMSAtIHR5cGVdID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh4MSAtIDEsIHkxKSk7CgkJCQlwb2x5LmNvbm5lY3Rpb25zWzJdID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh4MSwgeTEgKyAodHlwZSA9PT0gMCA/IDEgOiAtMSkpKTsKCQkJfQoJCX0KCX0sCgloZXhhZ29uOiB7CgkJZ2VuZXJhdGUoeCwgeSkgewoJCQljb25zdCBrZXlGcm9tID0gKHgsIHkpID0+IHgudG9TdHJpbmcoKSArICJfIiArIHkudG9TdHJpbmcoKTsKCQkJY29uc3Qgc2lkZUxlbiA9IDI0OwoJCQljb25zdCBtaWRwdFIgPSBzaWRlTGVuIC8gMiAvIE1hdGgudGFuKE1hdGguUEkgLyA2KTsKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB5OyBpKyspIHsKCQkJCWZvciAobGV0IGogPSAtTWF0aC5taW4oaSwgeSAtIDEgLSBpKTsgaiA8IHggKyBNYXRoLm1pbihpLCB5IC0gMSAtIGkpOyBqKyspIHsKCQkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQkJa2V5RnJvbShpICogMiwgaiAqIDIgKyAxKSwgCgkJCQkJCW5ldyBQb2x5Z29uKDYsIHNpZGVMZW4sIFsoaiArIDEpICogbWlkcHRSICogMiwgaSAqIHNpZGVMZW4gKiAzICsgc2lkZUxlbl0pCgkJCQkJKTsKCQkJCX0KCQkJfQoJCQlmb3IgKGxldCBpID0gMDsgaSA8IHkgLSAxOyBpKyspIHsKCQkJCWZvciAobGV0IGogPSAtTWF0aC5taW4oaSwgeSAtIDIgLSBpKTsgaiA8IHggKyAxICsgTWF0aC5taW4oaSwgeSAtIDIgLSBpKTsgaisrKSB7CgkJCQkJZ2FtZS5ib2FyZC5zZXQoCgkJCQkJCWtleUZyb20oaSAqIDIgKyAxLCBqICogMiksIAoJCQkJCQluZXcgUG9seWdvbig2LCBzaWRlTGVuLCBbaiAqIG1pZHB0UiAqIDIgKyBtaWRwdFIsIGkgKiBzaWRlTGVuICogMyArIHNpZGVMZW4gKiAyLjVdKQoJCQkJCSk7CgkJCQl9CgkJCX0KCQkJZm9yIChjb25zdCBba2V5LCBwb2x5XSBvZiBnYW1lLmJvYXJkKSB7CgkJCQlsZXQgW3kxLCB4MV0gPSBrZXkuc3BsaXQoIl8iKTsKCQkJCXgxID0gcGFyc2VJbnQoeDEsIDEwKTsKCQkJCXkxID0gcGFyc2VJbnQoeTEsIDEwKTsKCQkJCXBvbHkuY29ubmVjdGlvbnNbMF0gPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHkxLCB4MSArIDIpKTsKCQkJCXBvbHkuY29ubmVjdGlvbnNbMV0gPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHkxIC0gMSwgeDEgKyAxKSk7CgkJCQlwb2x5LmNvbm5lY3Rpb25zWzJdID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh5MSAtIDEsIHgxIC0gMSkpOwoJCQkJcG9seS5jb25uZWN0aW9uc1szXSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeTEsIHgxIC0gMikpOwoJCQkJcG9seS5jb25uZWN0aW9uc1s0XSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeTEgKyAxLCB4MSAtIDEpKTsKCQkJCXBvbHkuY29ubmVjdGlvbnNbNV0gPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHkxICsgMSwgeDEgKyAxKSk7CgkJCX0KCQkJZ2FtZS5zb3VyY2UgPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHkgLSAxLCBNYXRoLmNlaWwoeCAvIDIpICogMiAtICgoeSAlIDIgPT09IDEpID8gMSA6IDApKSk7CgkJfQoJfSwKCWthZ29tZTogewoJCWdlbmVyYXRlKHgsIHksIHdyYXAgPSBmYWxzZSkgewoJCQljb25zdCBrZXlGcm9tID0gKC4uLmUpID0+IGUuam9pbigiXyIpOwoJCQljb25zdCBzaWRlTGVuID0gNDA7CgkJCWNvbnN0IG1pZHB0UiA9IHNpZGVMZW4gKiBNYXRoLnNxcnQoMykgLyAyOwoJCQlmb3IgKGxldCBpID0gMDsgaSA8IHk7IGkrKykgewoJCQkJZm9yIChsZXQgaiA9IDA7IGogPCB4OyBqKyspIHsKCQkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQkJa2V5RnJvbShpLCBqICogMiArIGkgJSAyKSwgCgkJCQkJCW5ldyBQb2x5Z29uKDYsIHNpZGVMZW4sIFsoaiAqIDIgKyBpICUgMikgKiBzaWRlTGVuLCAoaSArIDEpICogbWlkcHRSICogMl0sIE1hdGguUEkgLyA2KQoJCQkJCSk7CgkJCQkJZ2FtZS5ib2FyZC5zZXQoCgkJCQkJCWtleUZyb20oaSwgaiAqIDIgKyAxIC0gaSAlIDIsIDApLAoJCQkJCQluZXcgUG9seWdvbigzLCBzaWRlTGVuLCBbKGogKiAyICsgMSAtIChpICUgMikpICogc2lkZUxlbiwgKGkgKyAyLzMpICogbWlkcHRSICogMl0sIC1NYXRoLlBJICogNSAvIDYpCgkJCQkJKTsKCQkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQkJa2V5RnJvbShpLCBqICogMiArIDEgLSBpICUgMiwgMSksCgkJCQkJCW5ldyBQb2x5Z29uKDMsIHNpZGVMZW4sIFsoaiAqIDIgKyAxIC0gKGkgJSAyKSkgKiBzaWRlTGVuLCAoaSArIDQvMykgKiBtaWRwdFIgKiAyXSwgTWF0aC5QSSAvIDYpCgkJCQkJKTsKCQkJCX0KCQkJfQoJCQlpZiAoIXdyYXApIHsKCQkJCWdhbWUuYm9hcmQuZGVsZXRlKGtleUZyb20oMCwgeCAqIDIgLSAxLCAwKSk7CgkJCQlnYW1lLmJvYXJkLmRlbGV0ZShrZXlGcm9tKHkgLSAxLCAoeSAlIDIpICogKHggKiAyIC0gMSksIDEpKTsKCQkJfQoJCQljb25zdCBtb2RYID0gd3JhcCA/IHggKiAyIDogMWU3LCBtb2RZID0gd3JhcCA/IHkgOiAxZTc7CgkJCWZvciAoY29uc3QgW2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQkJaWYgKHBvbHkuc2lkZXMgIT09IDMpIGNvbnRpbnVlOwoJCQkJbGV0IFt5MSwgeDEsIHpdID0ga2V5LnNwbGl0KCJfIik7CgkJCQl4MSA9IHBhcnNlSW50KHgxLCAxMCk7CgkJCQl5MSA9IHBhcnNlSW50KHkxLCAxMCk7CgkJCQl6ID0gcGFyc2VJbnQoeiwgMTApOwoJCQkJY29uc3QgbGVmdCA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeTEsICh4MSArIG1vZFggLSAxKSAlIG1vZFgpKTsKCQkJCWNvbnN0IHJpZ2h0ID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh5MSwgKHgxICsgMSkgJSBtb2RYKSk7CgkJCQlzd2l0Y2ggKHopIHsKCQkJCQljYXNlIDA6IHsKCQkJCQkJY29uc3QgdG9wID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSgoeTEgKyBtb2RZIC0gMSkgJSBtb2RZLCB4MSkpOwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzJdID0gdG9wOwoJCQkJCQlpZiAodG9wKSB0b3AuY29ubmVjdGlvbnNbNF0gPSBwb2x5OwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzBdID0gbGVmdDsKCQkJCQkJaWYgKGxlZnQpIGxlZnQuY29ubmVjdGlvbnNbMF0gPSBwb2x5OwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzFdID0gcmlnaHQ7CgkJCQkJCWlmIChyaWdodCkgcmlnaHQuY29ubmVjdGlvbnNbMl0gPSBwb2x5OwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAxOiB7CgkJCQkJCWNvbnN0IGJvdHRvbSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oKHkxICsgMSkgJSBtb2RZLCB4MSkpOwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzJdID0gYm90dG9tOwoJCQkJCQlpZiAoYm90dG9tKSBib3R0b20uY29ubmVjdGlvbnNbMV0gPSBwb2x5OwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzFdID0gbGVmdDsKCQkJCQkJaWYgKGxlZnQpIGxlZnQuY29ubmVjdGlvbnNbNV0gPSBwb2x5OwoJCQkJCQlwb2x5LmNvbm5lY3Rpb25zWzBdID0gcmlnaHQ7CgkJCQkJCWlmIChyaWdodCkgcmlnaHQuY29ubmVjdGlvbnNbM10gPSBwb2x5OwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJY29uc3Qgc291cmNlWSA9IE1hdGguZmxvb3IoeSAvIDIpLAoJCQlzb3VyY2VYID0gTWF0aC5mbG9vcih4IC8gMikgKiAyICsgc291cmNlWSAlIDI7CgkJCWdhbWUuc291cmNlID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbShzb3VyY2VZLCBzb3VyY2VYKSk7CgkJfQoJfSwKCWthZ29tZVdyYXA6IHsKCQlnZW5lcmF0ZSh4LCB5KSB7CgkJCWNvbnN0IGtleUZyb20gPSAoLi4uZSkgPT4gZS5qb2luKCJfIik7CgkJCWNvbnN0IHNpZGVMZW4gPSA0MDsKCQkJY29uc3QgbWlkcHRSID0gc2lkZUxlbiAqIE1hdGguc3FydCgzKSAvIDI7CgkJCS8vIHkgaGFzIHRvIGJlIGEgbXVsdGlwbGUgb2YgMgoJCQl5ID0gTWF0aC5jZWlsKHkgLyAyKSAqIDI7CgkJCUJPQVJEX1RZUEVTLmthZ29tZS5nZW5lcmF0ZSh4LCB5LCB0cnVlKTsKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB5OyBpICs9IDIpIHsKCQkJCWNvbnN0IHQwID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbShpLCB4ICogMiAtIDEsIDApKSwKCQkJCQl0MSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oaSwgeCAqIDIgLSAxLCAxKSk7CgkJCQljb25zdCBoZXggPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKGksIDApKTsKCQkJCWdhbWUuYm9hcmQuc2V0KGtleUZyb20oaSwgeCAqIDIpLCBuZXcgSG9sb2dyYW0oaGV4LCBbKHggKiAyKSAqIHNpZGVMZW4sIChpICsgMSkgKiBtaWRwdFIgKiAyXSkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoa2V5RnJvbShpLCAtMSwgMCksIG5ldyBIb2xvZ3JhbSh0MCwgWy1zaWRlTGVuLCAoaSArIDIvMykgKiBtaWRwdFIgKiAyXSkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoa2V5RnJvbShpLCAtMSwgMSksIG5ldyBIb2xvZ3JhbSh0MSwgWy1zaWRlTGVuLCAoaSArIDQvMykgKiBtaWRwdFIgKiAyXSkpOwoJCQl9CgkJCWZvciAobGV0IGkgPSAxOyBpIDwgeTsgaSArPSAyKSB7CgkJCQljb25zdCB0MCA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oaSwgMCwgMCkpLAoJCQkJCXQxID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbShpLCAwLCAxKSk7CgkJCQljb25zdCBoZXggPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKGksIHggKiAyIC0gMSkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoa2V5RnJvbShpLCAtMSksIG5ldyBIb2xvZ3JhbShoZXgsIFstc2lkZUxlbiwgKGkgKyAxKSAqIG1pZHB0UiAqIDJdKSk7CgkJCQlnYW1lLmJvYXJkLnNldChrZXlGcm9tKGksIHggKiAyLCAwKSwgbmV3IEhvbG9ncmFtKHQwLCBbKHggKiAyKSAqIHNpZGVMZW4sIChpICsgMi8zKSAqIG1pZHB0UiAqIDJdKSk7CgkJCQlnYW1lLmJvYXJkLnNldChrZXlGcm9tKGksIHggKiAyLCAxKSwgbmV3IEhvbG9ncmFtKHQxLCBbKHggKiAyKSAqIHNpZGVMZW4sIChpICsgNC8zKSAqIG1pZHB0UiAqIDJdKSk7CgkJCX0KCQkJZm9yIChsZXQgaiA9IDA7IGogPCB4OyBqKyspIHsKCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCWtleUZyb20oeSwgaiAqIDIpLCAKCQkJCQluZXcgSG9sb2dyYW0oZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSgwLCBqICogMikpLCBbaiAqIDIgKiBzaWRlTGVuLCAoeSArIDEpICogbWlkcHRSICogMl0pCgkJCQkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoCgkJCQkJa2V5RnJvbSh5LCBqICogMiArIDEsIDApLAoJCQkJCW5ldyBIb2xvZ3JhbShnYW1lLmJvYXJkLmdldChrZXlGcm9tKDAsIGogKiAyICsgMSwgMCkpLCBbKGogKiAyICsgMSkgKiBzaWRlTGVuLCAoeSArIDIvMykgKiBtaWRwdFIgKiAyXSkKCQkJCSk7CgkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQlrZXlGcm9tKHksIGogKiAyICsgMSwgMSksCgkJCQkJbmV3IEhvbG9ncmFtKGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oMCwgaiAqIDIgKyAxLCAxKSksIFsoaiAqIDIgKyAxKSAqIHNpZGVMZW4sICh5ICsgNC8zKSAqIG1pZHB0UiAqIDJdKQoJCQkJKTsKCgkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQlrZXlGcm9tKC0xLCBqICogMiArIDEpLCAKCQkJCQluZXcgSG9sb2dyYW0oZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh5IC0gMSwgaiAqIDIgKyAxKSksIFsoaiAqIDIgKyAxKSAqIHNpZGVMZW4sIDBdKQoJCQkJKTsKCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCWtleUZyb20oLTEsIGogKiAyLCAwKSwKCQkJCQluZXcgSG9sb2dyYW0oZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh5IC0gMSwgaiAqIDIsIDApKSwgW2ogKiAyICogc2lkZUxlbiwgLTIvMyAqIG1pZHB0Ul0pCgkJCQkpOwoJCQkJZ2FtZS5ib2FyZC5zZXQoCgkJCQkJa2V5RnJvbSgtMSwgaiAqIDIsIDEpLAoJCQkJCW5ldyBIb2xvZ3JhbShnYW1lLmJvYXJkLmdldChrZXlGcm9tKHkgLSAxLCBqICogMiwgMSkpLCBbaiAqIDIgKiBzaWRlTGVuLCAyLzMgKiBtaWRwdFJdKQoJCQkJKTsKCQkJfQoJCQlnYW1lLmJvYXJkLnNldCgKCQkJCWtleUZyb20oeSwgeCAqIDIpLAoJCQkJbmV3IEhvbG9ncmFtKGdhbWUuYm9hcmQuZ2V0KCIwXzAiKSwgWyh4ICogMikgKiBzaWRlTGVuLCAoeSArIDEpICogbWlkcHRSICogMl0pCgkJCSk7CgkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJa2V5RnJvbSgtMSwgLTIpLAoJCQkJbmV3IEhvbG9ncmFtKGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeSAtIDEsIHggKiAyIC0gMSkpLCBbLXNpZGVMZW4sIDBdKQoJCQkpOwoJCQlnYW1lLmJvYXJkLnNldCgKCQkJCWtleUZyb20oeSwgLTEsIDApLAoJCQkJbmV3IEhvbG9ncmFtKGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oMCwgeCAqIDIgLSAxLCAwKSksIFstc2lkZUxlbiwgKHkgKyAyLzMpICogbWlkcHRSICogMl0pCgkJCSk7CgkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJa2V5RnJvbSgtMSwgeCAqIDIsIDEpLAoJCQkJbmV3IEhvbG9ncmFtKGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeSAtIDEsIDAsIDEpKSwgW3ggKiAyICogc2lkZUxlbiwgMi8zICogbWlkcHRSXSkKCQkJKTsKCQl9Cgl9LAoJb2N0YWdvbmFsOiB7CgkJZ2VuZXJhdGUoeCwgeSkgewoJCQljb25zdCBrZXlGcm9tID0gKC4uLmUpID0+IGUuam9pbigiXyIpOwoJCQljb25zdCBzaWRlTGVuID0gMzU7CgkJCWNvbnN0IGRpYWcgPSAzNSAvIE1hdGguc3FydCgyKTsKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB4OyBpKyspIHsKCQkJCWZvciAobGV0IGogPSAwOyBqIDwgeTsgaisrKSB7CgkJCQkJZ2FtZS5ib2FyZC5zZXQoCgkJCQkJCWtleUZyb20oMiAqIGksIDIgKiBqKSwgCgkJCQkJCW5ldyBQb2x5Z29uKDgsIHNpZGVMZW4sIFsoaSArIDAuNSkgKiAoc2lkZUxlbiArIGRpYWcgKiAyKSwgKGogKyAwLjUpICogKHNpZGVMZW4gKyBkaWFnICogMildKQoJCQkJCSk7CgkJCQl9CgkJCX0KCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB4IC0gMTsgaSsrKSB7CgkJCQlmb3IgKGxldCBqID0gMDsgaiA8IHkgLSAxOyBqKyspIHsKCQkJCQlnYW1lLmJvYXJkLnNldCgKCQkJCQkJa2V5RnJvbSgyICogaSArIDEsIDIgKiBqICsgMSksIAoJCQkJCQluZXcgUG9seWdvbig0LCBzaWRlTGVuLCBbKGkgKyAxKSAqIChzaWRlTGVuICsgZGlhZyAqIDIpLCAoaiArIDEpICogKHNpZGVMZW4gKyBkaWFnICogMildLCBNYXRoLlBJIC8gNCkKCQkJCQkpOwoJCQkJfQoJCQl9CgkJCWZ1bmN0aW9uIG1ha2VDb24oW3AxLCBpZDFdLCBbcDIsIGlkMl0pIHsKCQkJCXAxLmNvbm5lY3Rpb25zW2lkMV0gPSBwMjsKCQkJCWlmIChwMikgcDIuY29ubmVjdGlvbnNbaWQyXSA9IHAxOwoJCQl9CgkJCWZvciAoY29uc3QgW2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCQkJaWYgKHBvbHkuc2lkZXMgIT09IDgpIGNvbnRpbnVlOwoJCQkJbGV0IFt4MSwgeTFdID0ga2V5LnNwbGl0KCJfIik7CgkJCQl4MSA9IHBhcnNlSW50KHgxLCAxMCk7CgkJCQl5MSA9IHBhcnNlSW50KHkxLCAxMCk7CgkJCQljb25zdCByaWdodCA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeDEgKyAyLCB5MSkpOwoJCQkJY29uc3QgYm90dG9tID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh4MSwgeTEgKyAyKSk7CgkJCQljb25zdCB0bCA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeDEgLSAxLCB5MSAtIDEpKTsKCQkJCWNvbnN0IHRyID0gZ2FtZS5ib2FyZC5nZXQoa2V5RnJvbSh4MSArIDEsIHkxIC0gMSkpOwoJCQkJY29uc3QgYnIgPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKHgxICsgMSwgeTEgKyAxKSk7CgkJCQljb25zdCBibCA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeDEgLSAxLCB5MSArIDEpKTsKCQkJCW1ha2VDb24oW3BvbHksIDBdLCBbcmlnaHQsIDRdKTsKCQkJCW1ha2VDb24oW3BvbHksIDZdLCBbYm90dG9tLCAyXSk7CgkJCQltYWtlQ29uKFtwb2x5LCAzXSwgW3RsLCAzXSk7CgkJCQltYWtlQ29uKFtwb2x5LCAxXSwgW3RyLCAyXSk7CgkJCQltYWtlQ29uKFtwb2x5LCA3XSwgW2JyLCAxXSk7CgkJCQltYWtlQ29uKFtwb2x5LCA1XSwgW2JsLCAwXSk7CgkJCX0KCQkJaWYgKHggJSAyID09PSAwICYmIHkgJSAyID09PSAwKSBnYW1lLnNvdXJjZSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oeCAtIDEsIHkgLSAxKSkKCQkJZWxzZSBnYW1lLnNvdXJjZSA9IGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oTWF0aC5mbG9vcih4IC8gMikgKiAyLCBNYXRoLmZsb29yKHkgLyAyKSAqIDIpKTsKCQl9Cgl9LAoJZG9kZWNhZ29uYWw6IHsKCQlnZW5lcmF0ZSh4LCB5KSB7CgkJCWNvbnN0IGtleUZyb20gPSAoLi4uZSkgPT4gZS5qb2luKCJfIik7CgkJCWNvbnN0IHNpZGVMZW4gPSAzMjsKCQkJY29uc3QgZG9jTWlkcHRSID0gc2lkZUxlbiAvIE1hdGgudGFuKE1hdGguUEkgLyAxMikgLyAyOwoJCQljb25zdCBoZXhNaWRwdFIgPSBzaWRlTGVuIC8gTWF0aC50YW4oTWF0aC5QSSAvIDYpIC8gMjsKCQkJY29uc3Qgc3FNaWRwdFIgPSBzaWRlTGVuIC8gMjsKCQkJY29uc3QgdW5pdEQgPSBkb2NNaWRwdFIgKiAyICsgc2lkZUxlbjsKCQkJY29uc3QgZXVEaXN0U3EgPSAoW2EsIGJdLCBbYywgZF0pID0+IChhIC0gYykgKiAoYSAtIGMpICsgKGIgLSBkKSAqIChiIC0gZCk7CgkJCWxldCBjYWxscyA9IDA7CgkJCWNvbnN0IG1ha2VDb24gPSAoYSwgYikgPT4gewoJCQkJY2FsbHMrKzsKCQkJCWxldCBhSWQgPSAwLCBhQ2xvc2VzdCA9IEluZmluaXR5OwoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBhLnNpZGVzOyBpKyspIHsKCQkJCQljb25zdCBlID0gZXVEaXN0U3EoYS5taWRwdHNbaV0sIGIucG9zaXRpb24pOwoJCQkJCWlmIChlIDwgYUNsb3Nlc3QpIHsKCQkJCQkJYUNsb3Nlc3QgPSBlOwoJCQkJCQlhSWQgPSBpOwoJCQkJCX0KCQkJCX0KCQkJCWxldCBiSWQgPSAwLCBiQ2xvc2VzdCA9IEluZmluaXR5OwoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBiLnNpZGVzOyBpKyspIHsKCQkJCQljb25zdCBlID0gZXVEaXN0U3EoYi5taWRwdHNbaV0sIGEucG9zaXRpb24pOwoJCQkJCWlmIChlIDwgYkNsb3Nlc3QpIHsKCQkJCQkJYkNsb3Nlc3QgPSBlOwoJCQkJCQliSWQgPSBpOwoJCQkJCX0KCQkJCX0KCQkJCWEuY29ubmVjdGlvbnNbYUlkXSA9IGI7CgkJCQliLmNvbm5lY3Rpb25zW2JJZF0gPSBhOwoJCQl9CgkJCWZvciAobGV0IGkgPSAwOyBpIDwgeDsgaSsrKSB7CgkJCQlmb3IgKGxldCBqID0gMDsgaiA8IHk7IGorKykgewoJCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCQlrZXlGcm9tKCJkZGMiLCBpLCBqKSwKCQkJCQkJbmV3IFBvbHlnb24oMTIsIHNpZGVMZW4sIFsoaSArIChqICUgMikgLyAyICsgMTApICogdW5pdEQsIChqICsgMTApICogdW5pdEQgKiBNYXRoLnNxcnQoMy80KV0pCgkJCQkJKTsKCQkJCQljb25zdCBkZGMgPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKCJkZGMiLCBpLCBqKSk7CgkJCQkJY29uc3QgW3gxLCB5MV0gPSBkZGMucG9zaXRpb247CgkJCQkJbGV0IHBvbHlzID0gW107CgkJCQkJZm9yIChsZXQgayA9IDA7IGsgPCA2OyBrKyspIHsKCQkJCQkJY29uc3Qgc3FBbmcgPSBrICogMiAqIE1hdGguUEkgLyA2OwoJCQkJCQljb25zdCBzcVggPSBNYXRoLmNvcygtc3FBbmcpICogKGRvY01pZHB0UiArIHNxTWlkcHRSKSArIHgxOwoJCQkJCQljb25zdCBzcVkgPSBNYXRoLnNpbigtc3FBbmcpICogKGRvY01pZHB0UiArIHNxTWlkcHRSKSArIHkxOwoJCQkJCQlpZiAoIWdhbWUuYm9hcmQuZ2V0KGtleUZyb20oc3FYLnRvRml4ZWQoNSksIHNxWS50b0ZpeGVkKDUpKSkpIHsKCQkJCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCQkJCWtleUZyb20oc3FYLnRvRml4ZWQoNSksIHNxWS50b0ZpeGVkKDUpKSwKCQkJCQkJCQluZXcgUG9seWdvbig0LCBzaWRlTGVuLCBbc3FYLCBzcVldLCBzcUFuZykKCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJcG9seXMucHVzaChnYW1lLmJvYXJkLmdldChrZXlGcm9tKHNxWC50b0ZpeGVkKDUpLCBzcVkudG9GaXhlZCg1KSkpKTsKCQkJCQkJY29uc3QgaGV4QW5nID0gKGsgKiAyICsgMSkgKiBNYXRoLlBJIC8gNjsKCQkJCQkJY29uc3QgaGV4WCA9IE1hdGguY29zKC1oZXhBbmcpICogKGRvY01pZHB0UiArIGhleE1pZHB0UikgKyB4MTsKCQkJCQkJY29uc3QgaGV4WSA9IE1hdGguc2luKC1oZXhBbmcpICogKGRvY01pZHB0UiArIGhleE1pZHB0UikgKyB5MTsKCQkJCQkJaWYgKCFnYW1lLmJvYXJkLmdldChrZXlGcm9tKGhleFgudG9GaXhlZCg1KSwgaGV4WS50b0ZpeGVkKDUpKSkpIHsKCQkJCQkJCWdhbWUuYm9hcmQuc2V0KAoJCQkJCQkJCWtleUZyb20oaGV4WC50b0ZpeGVkKDUpLCBoZXhZLnRvRml4ZWQoNSkpLAoJCQkJCQkJCW5ldyBQb2x5Z29uKDYsIHNpZGVMZW4sIFtoZXhYLCBoZXhZXSwgaGV4QW5nKQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCQlwb2x5cy5wdXNoKGdhbWUuYm9hcmQuZ2V0KGtleUZyb20oaGV4WC50b0ZpeGVkKDUpLCBoZXhZLnRvRml4ZWQoNSkpKSk7CgkJCQkJfQoJCQkJCWZvciAoY29uc3QgcG9seSBvZiBwb2x5cykgewoJCQkJCQltYWtlQ29uKGRkYywgcG9seSk7CgkJCQkJfQoJCQkJCWZvciAobGV0IGkgPSAxOyBpIDwgMTI7IGkgKz0gMikgewoJCQkJCQltYWtlQ29uKHBvbHlzW2ldLCBwb2x5c1tpIC0gMV0pOwoJCQkJCQltYWtlQ29uKHBvbHlzW2ldLCBwb2x5c1soaSArIDEpICUgMTJdKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZ2FtZS5zb3VyY2UgPSBnYW1lLmJvYXJkLmdldChrZXlGcm9tKCJkZGMiLCBNYXRoLmZsb29yKHggLyAyKSwgTWF0aC5mbG9vcih5IC8gMikpKTsKCQkJY29uc29sZS5sb2coY2FsbHMpOwoJCX0KCX0KfQoKd2luZG93Lm9ubG9hZCA9ICgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBnYW1lLmdlbmVyYXRlR2FtZSgic3F1YXJlIiwgNSwgNSkpOwo=" defer="defer"></script><script type="text/javascript" src="data:text/javascript;base64,Y29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImMiKSwgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CgpmdW5jdGlvbiByZW5kZXJQb2x5Z29uKHBvbHlnb24pIHsKCWN0eC5maWxsU3R5bGUgPSBwb2x5Z29uLmxvY2tlZCA/ICIjNzc3IiA6ICIjYmJiIjsKCWN0eC5zdHJva2VTdHlsZSA9IHBvbHlnb24ubG9ja2VkID8gIiM3NzciIDogIiNiYmIiOwoJY3R4LmxpbmVXaWR0aCA9IDE7CgljdHguYmVnaW5QYXRoKCk7CgljdHgubW92ZVRvKHBvbHlnb24udmVydGljZXNbMF1bMF0sIHBvbHlnb24udmVydGljZXNbMF1bMV0pOwoJZm9yIChsZXQgaSA9IDE7IGkgPD0gcG9seWdvbi5zaWRlczsgaSsrKSB7CgkJY3R4LmxpbmVUbyhwb2x5Z29uLnZlcnRpY2VzW2kgJSBwb2x5Z29uLnNpZGVzXVswXSwgcG9seWdvbi52ZXJ0aWNlc1tpICUgcG9seWdvbi5zaWRlc11bMV0pOwoJfQoJY3R4LmZpbGwoKTsKCWN0eC5zdHJva2UoKTsKCWxldCBjb25uZWN0aW9ucyA9IDA7Cglmb3IgKGxldCBpID0gMDsgaSA8IHBvbHlnb24uc2lkZXM7IGkrKykgewoJCWlmICgocG9seWdvbi5waXBlcyAmICgxIDw8IGkpKSA9PT0gMCkgY29udGludWU7CgkJY29ubmVjdGlvbnMrKzsKCX0KCWN0eC5maWxsU3R5bGUgPSAiIzAwMCI7CgljdHguYmVnaW5QYXRoKCk7Cgljb25zdCBjaXJjbGVTaXplID0gcG9seWdvbiA9PT0gZ2FtZS5zb3VyY2UgPyAxMCA6IChjb25uZWN0aW9ucyA+IDEgPyAyIDogNyk7CgljdHguYXJjKHBvbHlnb24ucG9zaXRpb25bMF0sIHBvbHlnb24ucG9zaXRpb25bMV0sIGNpcmNsZVNpemUsIDAsIDIgKiBNYXRoLlBJKTsKCWN0eC5maWxsKCk7CgljdHguc3Ryb2tlU3R5bGUgPSAiIzAwMCI7CgljdHgubGluZVdpZHRoID0gNDsKCWN0eC5iZWdpblBhdGgoKTsKCWNvbnN0IFt4LCB5XSA9IHBvbHlnb24ucG9zaXRpb247Cglmb3IgKGxldCBpID0gMDsgaSA8IHBvbHlnb24uc2lkZXM7IGkrKykgewoJCWlmICgocG9seWdvbi5waXBlcyAmICgxIDw8IGkpKSA9PT0gMCkgY29udGludWU7CgkJY3R4Lm1vdmVUbyh4LCB5KTsKCQlsZXQgdiA9IFtwb2x5Z29uLm1pZHB0c1tpXVswXSAtIHgsIHBvbHlnb24ubWlkcHRzW2ldWzFdIC0geV07CgkJLy8gUm90YXRpb24gbWF0cml4CgkJY29uc3QgYW5nID0gLXBvbHlnb24ucGlwZXNSb3RhdGlvbkRpc3BsYXkgKiAyICogTWF0aC5QSSAvIHBvbHlnb24uc2lkZXM7CgkJY29uc3QgY29zYW5nID0gTWF0aC5jb3MoYW5nKSwgc2luYW5nID0gTWF0aC5zaW4oYW5nKTsKCQl2ID0gW3ZbMF0gKiBjb3NhbmcgLSB2WzFdICogc2luYW5nLCB2WzBdICogc2luYW5nICsgdlsxXSAqIGNvc2FuZ107CgkJY3R4LmxpbmVUbyh2WzBdICsgeCwgdlsxXSArIHkpOwoJfQoJY3R4LnN0cm9rZSgpOwoJaWYgKHBvbHlnb24uaGFzTGlnaHQpIHsKCQljdHguYmVnaW5QYXRoKCk7CgkJY3R4LmxpbmVXaWR0aCA9IDI7CgkJY3R4LnN0cm9rZVN0eWxlID0gcG9seWdvbi5oYXNDeWNsZSA/ICIjZjAwIiA6ICIjN2NmIjsKCQlmb3IgKGxldCBpID0gMDsgaSA8IHBvbHlnb24uc2lkZXM7IGkrKykgewoJCQlpZiAoKHBvbHlnb24ucGlwZXMgJiAoMSA8PCBpKSkgPT09IDApIGNvbnRpbnVlOwoJCQljdHgubW92ZVRvKHgsIHkpOwoJCQlsZXQgdiA9IFtwb2x5Z29uLm1pZHB0c1tpXVswXSAtIHgsIHBvbHlnb24ubWlkcHRzW2ldWzFdIC0geV07CgkJCS8vIFJvdGF0aW9uIG1hdHJpeAoJCQljb25zdCBhbmcgPSAtcG9seWdvbi5waXBlc1JvdGF0aW9uRGlzcGxheSAqIDIgKiBNYXRoLlBJIC8gcG9seWdvbi5zaWRlczsKCQkJY29uc3QgY29zYW5nID0gTWF0aC5jb3MoYW5nKSwgc2luYW5nID0gTWF0aC5zaW4oYW5nKTsKCQkJdiA9IFt2WzBdICogY29zYW5nIC0gdlsxXSAqIHNpbmFuZywgdlswXSAqIHNpbmFuZyArIHZbMV0gKiBjb3NhbmddOwoJCQljdHgubGluZVRvKHZbMF0gKyB4LCB2WzFdICsgeSk7CgkJfQoJCWN0eC5zdHJva2UoKTsKCX0KCWlmIChwb2x5Z29uLmxvY2tlZCkgewoJCWN0eC5iZWdpblBhdGgoKTsKCQljdHgubGluZVdpZHRoID0gMjsKCQljdHguc3Ryb2tlU3R5bGUgPSAiI2YwMCI7CgkJZm9yIChsZXQgaSA9IDA7IGkgPCBwb2x5Z29uLnNpZGVzOyBpKyspIHsKCQkJaWYgKChwb2x5Z29uLnBpcGVzICYgKDEgPDwgaSkpID09PSAwKSBjb250aW51ZTsKCQkJY29uc3Qgb3RoZXIgPSBwb2x5Z29uLmNvbm5lY3Rpb25zWyhpICsgcG9seWdvbi5waXBlc1JvdGF0aW9uKSAlIHBvbHlnb24uc2lkZXNdOwoJCQlpZiAob3RoZXIgJiYgKCFvdGhlci5sb2NrZWQgfHwgb3RoZXIuaGFzQ29ubmVjdGlvbihvdGhlci5jb25uZWN0aW9ucy5pbmRleE9mKHBvbHlnb24pKSkpIGNvbnRpbnVlOwoJCQljdHgubW92ZVRvKHgsIHkpOwoJCQlsZXQgdiA9IFtwb2x5Z29uLm1pZHB0c1tpXVswXSAtIHgsIHBvbHlnb24ubWlkcHRzW2ldWzFdIC0geV07CgkJCS8vIFJvdGF0aW9uIG1hdHJpeAoJCQljb25zdCBhbmcgPSAtcG9seWdvbi5waXBlc1JvdGF0aW9uRGlzcGxheSAqIDIgKiBNYXRoLlBJIC8gcG9seWdvbi5zaWRlczsKCQkJY29uc3QgY29zYW5nID0gTWF0aC5jb3MoYW5nKSwgc2luYW5nID0gTWF0aC5zaW4oYW5nKTsKCQkJdiA9IFt2WzBdICogY29zYW5nIC0gdlsxXSAqIHNpbmFuZywgdlswXSAqIHNpbmFuZyArIHZbMV0gKiBjb3NhbmddOwoJCQljdHgubGluZVRvKHZbMF0gKyB4LCB2WzFdICsgeSk7CgkJfQoJCWN0eC5zdHJva2UoKTsKCX0KCWlmIChwb2x5Z29uID09PSBnYW1lLnNvdXJjZSkgewoJCWN0eC5maWxsU3R5bGUgPSAiIzAwMCI7CgkJY3R4LmJlZ2luUGF0aCgpOwoJCWN0eC5hcmMocG9seWdvbi5wb3NpdGlvblswXSwgcG9seWdvbi5wb3NpdGlvblsxXSwgMTAsIDAsIDIgKiBNYXRoLlBJKTsKCQljdHguZmlsbCgpOwoJCWN0eC5zdHJva2VTdHlsZSA9IGdhbWUuc291cmNlLmhhc0N5Y2xlID8gIiNmMDAiIDogIiM3Y2YiOwoJCWN0eC5saW5lV2lkdGggPSAzOwoJCWN0eC5iZWdpblBhdGgoKTsKCQljdHguYXJjKHBvbHlnb24ucG9zaXRpb25bMF0sIHBvbHlnb24ucG9zaXRpb25bMV0sIDYsIDAsIDIgKiBNYXRoLlBJKTsKCQljdHguc3Ryb2tlKCk7Cgl9IGVsc2UgaWYgKHBvbHlnb24uaGFzTGlnaHQpIHsKCQljdHguZmlsbFN0eWxlID0gcG9seWdvbi5oYXNDeWNsZSA/ICIjZjAwIiA6ICIjN2NmIjsKCQljdHguYmVnaW5QYXRoKCk7CgkJY3R4LmFyYyhwb2x5Z29uLnBvc2l0aW9uWzBdLCBwb2x5Z29uLnBvc2l0aW9uWzFdLCBjaXJjbGVTaXplIC0gMSwgMCwgMiAqIE1hdGguUEkpOwoJCWN0eC5maWxsKCk7Cgl9Cn0KZnVuY3Rpb24gcmVuZGVySG9sb2dyYW0oaG9sbykgewoJY3R4LnRyYW5zbGF0ZShob2xvLnBvc2l0aW9uWzBdIC0gaG9sby5wYXJlbnQucG9zaXRpb25bMF0sIGhvbG8ucG9zaXRpb25bMV0gLSBob2xvLnBhcmVudC5wb3NpdGlvblsxXSk7CglyZW5kZXJQb2x5Z29uKGhvbG8ucGFyZW50KTsKCWN0eC5maWxsU3R5bGUgPSAiI2VlZTgiOwoJY3R4LmJlZ2luUGF0aCgpOwoJY29uc3QgcG9seWdvbiA9IGhvbG8ucGFyZW50OwoJY3R4Lm1vdmVUbyhwb2x5Z29uLnZlcnRpY2VzWzBdWzBdLCBwb2x5Z29uLnZlcnRpY2VzWzBdWzFdKTsKCWZvciAobGV0IGkgPSAxOyBpIDw9IHBvbHlnb24uc2lkZXM7IGkrKykgewoJCWN0eC5saW5lVG8ocG9seWdvbi52ZXJ0aWNlc1tpICUgcG9seWdvbi5zaWRlc11bMF0sIHBvbHlnb24udmVydGljZXNbaSAlIHBvbHlnb24uc2lkZXNdWzFdKTsKCX0KCWN0eC5maWxsKCk7CgljdHgudHJhbnNsYXRlKC1ob2xvLnBvc2l0aW9uWzBdICsgaG9sby5wYXJlbnQucG9zaXRpb25bMF0sIC1ob2xvLnBvc2l0aW9uWzFdICsgaG9sby5wYXJlbnQucG9zaXRpb25bMV0pOwp9CgpsZXQgY3VycmVudENhbnZhc1VwZGF0ZSA9IDA7CmxldCBpbml0ID0gZmFsc2U7CmxldCBib2FyZFRyYW5zZm9ybSA9IFtbMSwgMCwgMF0sIFswLCAxLCAwXSwgWzAsIDAsIDFdXTsKY29uc3QgTWF0cml4ID0gewoJdHJhbnNsYXRlKHgsIHkpIHsKCQlyZXR1cm4gW1sxLCAwLCAwXSwgWzAsIDEsIDBdLCBbeCwgeSwgMV1dOwoJfSwKCXNjYWxlKHgsIHkpIHsKCQlyZXR1cm4gW1t4LCAwLCAwXSwgWzAsIHksIDBdLCBbMCwgMCwgMV1dOwoJfSwKCW11bDN4MyhhLCBiKSB7CgkJcmV0dXJuIFsKCQkJWwoJCQkJYVswXVswXSpiWzBdWzBdICsgYVsxXVswXSpiWzBdWzFdICsgYVsyXVswXSpiWzBdWzJdLAoJCQkJYVswXVsxXSpiWzBdWzBdICsgYVsxXVsxXSpiWzBdWzFdICsgYVsyXVsxXSpiWzBdWzJdLAoJCQkJYVswXVsyXSpiWzBdWzBdICsgYVsxXVsyXSpiWzBdWzFdICsgYVsyXVsyXSpiWzBdWzJdLAoJCQldLAoJCQlbCgkJCQlhWzBdWzBdKmJbMV1bMF0gKyBhWzFdWzBdKmJbMV1bMV0gKyBhWzJdWzBdKmJbMV1bMl0sCgkJCQlhWzBdWzFdKmJbMV1bMF0gKyBhWzFdWzFdKmJbMV1bMV0gKyBhWzJdWzFdKmJbMV1bMl0sCgkJCQlhWzBdWzJdKmJbMV1bMF0gKyBhWzFdWzJdKmJbMV1bMV0gKyBhWzJdWzJdKmJbMV1bMl0sCgkJCV0sCgkJCVsKCQkJCWFbMF1bMF0qYlsyXVswXSArIGFbMV1bMF0qYlsyXVsxXSArIGFbMl1bMF0qYlsyXVsyXSwKCQkJCWFbMF1bMV0qYlsyXVswXSArIGFbMV1bMV0qYlsyXVsxXSArIGFbMl1bMV0qYlsyXVsyXSwKCQkJCWFbMF1bMl0qYlsyXVswXSArIGFbMV1bMl0qYlsyXVsxXSArIGFbMl1bMl0qYlsyXVsyXSwKCQkJXQoJCV07Cgl9LAoJdHJhbnNmb3JtVmVjdG9yKG0sIHYpIHsKCQlyZXR1cm4gWwoJCQltWzBdWzBdICogdlswXSArIG1bMV1bMF0gKiB2WzFdICsgbVsyXVswXSwKCQkJbVswXVsxXSAqIHZbMF0gKyBtWzFdWzFdICogdlsxXSArIG1bMl1bMV0sCgkJXTsKCX0KfTsKbGV0IHpvb21MZXZlbCA9IDE7CmZ1bmN0aW9uIGluaXRCb2FyZCgpIHsKCWxldCBtaW5YID0gSW5maW5pdHksIG1pblkgPSBJbmZpbml0eSwgbWF4WCA9IC1JbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eTsKCWZvciAoY29uc3QgW19rZXksIHBvbHldIG9mIGdhbWUuYm9hcmQpIHsKCQlmb3IgKGxldCB2ZXJ0ZXggb2YgcG9seS52ZXJ0aWNlcykgewoJCQltYXhYID0gTWF0aC5tYXgobWF4WCwgdmVydGV4WzBdKTsKCQkJbWF4WSA9IE1hdGgubWF4KG1heFksIHZlcnRleFsxXSk7CgkJCW1pblggPSBNYXRoLm1pbihtaW5YLCB2ZXJ0ZXhbMF0pOwoJCQltaW5ZID0gTWF0aC5taW4obWluWSwgdmVydGV4WzFdKTsKCQl9Cgl9CgljYW52YXMud2lkdGggPSAoKG1heFggLSBtaW5YKSArIDEwKSAqIHpvb21MZXZlbDsKCWNhbnZhcy5oZWlnaHQgPSAoKG1heFkgLSBtaW5ZKSArIDEwKSAqIHpvb21MZXZlbDsKCWN0eC5yZXNldFRyYW5zZm9ybSgpOwoJY3R4LnNjYWxlKHpvb21MZXZlbCwgem9vbUxldmVsKTsKCWN0eC50cmFuc2xhdGUoNSAtIG1pblgsIDUgLSBtaW5ZKTsKCWJvYXJkVHJhbnNmb3JtID0gTWF0cml4Lm11bDN4MyhNYXRyaXgudHJhbnNsYXRlKG1pblggLSA1LCBtaW5ZIC0gNSksIE1hdHJpeC5zY2FsZSgxL3pvb21MZXZlbCwgMS96b29tTGV2ZWwpKTsKCWlmICghaW5pdCkgc3RhcnRSZW5kZXJCb2FyZCgpOwoJaW5pdCA9IHRydWU7CglyZW5kZXJCb2FyZCh0cnVlKTsKfQpmdW5jdGlvbiByZW5kZXJCb2FyZChmb3JjZSA9IGZhbHNlKSB7CglpZiAoY2FudmFzLndpZHRoID4gd2luZG93LmlubmVyV2lkdGgpIGNhbnZhcy5zdHlsZS5hbGlnblNlbGYgPSAiZmxleC1zdGFydCI7CgllbHNlIGNhbnZhcy5zdHlsZS5hbGlnblNlbGYgPSAiY2VudGVyIjsKCWN1cnJlbnRDYW52YXNVcGRhdGUrKzsKCWNvbnN0IGhvbG9ncmFtcyA9IFtdOwoJZm9yIChjb25zdCBbX2tleSwgcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCWlmIChwb2x5IGluc3RhbmNlb2YgSG9sb2dyYW0pIHsKCQkJaG9sb2dyYW1zLnB1c2gocG9seSk7CgkJCWNvbnRpbnVlOwoJCX0KCQlwb2x5LnVwZGF0ZVBpcGVzUm90YXRpb25EaXNwbGF5KCk7CgkJaWYgKCFmb3JjZSAmJiBjdXJyZW50Q2FudmFzVXBkYXRlIC0gcG9seS5sYXN0Q2FudmFzVXBkYXRlID4gMikgY29udGludWU7CgkJcmVuZGVyUG9seWdvbihwb2x5KTsKCX0KCWZvciAoY29uc3QgaG9sbyBvZiBob2xvZ3JhbXMpIHsKCQlpZiAoIWZvcmNlICYmIGN1cnJlbnRDYW52YXNVcGRhdGUgLSBob2xvLnBhcmVudC5sYXN0Q2FudmFzVXBkYXRlID4gMikgY29udGludWU7CgkJcmVuZGVySG9sb2dyYW0oaG9sbyk7Cgl9Cn0KZnVuY3Rpb24gc3RhcnRSZW5kZXJCb2FyZCgpIHsKCXJlbmRlckJvYXJkKCk7CglyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RhcnRSZW5kZXJCb2FyZCk7Cn0KCmxldCBldmVudHNTdGFjayA9IFtdLCBldmVudHNTdGFja1B0ciA9IDA7CmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChldikgPT4gewoJbGV0IHggPSBldi5vZmZzZXRYLCB5ID0gZXYub2Zmc2V0WTsKCVt4LCB5XSA9IE1hdHJpeC50cmFuc2Zvcm1WZWN0b3IoYm9hcmRUcmFuc2Zvcm0sIFt4LCB5XSk7Cglmb3IgKGNvbnN0IFtfLCBfcG9seV0gb2YgZ2FtZS5ib2FyZCkgewoJCWlmIChfcG9seS5pc0NsaWNrZWQoeCwgeSkpIHsKCQkJY29uc3QgcG9seSA9IF9wb2x5IGluc3RhbmNlb2YgSG9sb2dyYW0gPyBfcG9seS5wYXJlbnQgOiBfcG9seTsKCQkJaWYgKGV2LnNoaWZ0S2V5KSB7CgkJCQlwb2x5LnBpcGVzUm90YXRlQW50aWNsb2Nrd2lzZSgpOwoJCQkJZXZlbnRzU3RhY2tbZXZlbnRzU3RhY2tQdHJdID0gWyJjYyIsIF9dOwoJCQl9IGVsc2UgewoJCQkJcG9seS5waXBlc1JvdGF0ZUNsb2Nrd2lzZSgpOwoJCQkJZXZlbnRzU3RhY2tbZXZlbnRzU3RhY2tQdHJdID0gWyJjIiwgX107CgkJCX0KCQkJZXZlbnRzU3RhY2tQdHIrKzsKCQkJaWYgKGV2ZW50c1N0YWNrLmxlbmd0aCA+IGV2ZW50c1N0YWNrUHRyKSBldmVudHNTdGFjay5sZW5ndGggPSBldmVudHNTdGFja1B0cjsKCQkJYnJlYWs7CgkJfQoJfQp9KTsKCmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIChldikgPT4gewoJaWYgKGdhbWUud29uKSByZXR1cm47CglsZXQgeCA9IGV2Lm9mZnNldFgsIHkgPSBldi5vZmZzZXRZOwoJW3gsIHldID0gTWF0cml4LnRyYW5zZm9ybVZlY3Rvcihib2FyZFRyYW5zZm9ybSwgW3gsIHldKTsKCWZvciAoY29uc3QgW18sIF9wb2x5XSBvZiBnYW1lLmJvYXJkKSB7CgkJaWYgKF9wb2x5LmlzQ2xpY2tlZCh4LCB5KSkgewoJCQljb25zdCBwb2x5ID0gX3BvbHkgaW5zdGFuY2VvZiBIb2xvZ3JhbSA/IF9wb2x5LnBhcmVudCA6IF9wb2x5OwoJCQlwb2x5LmxvY2tlZCA9ICFwb2x5LmxvY2tlZDsKCQkJZXZlbnRzU3RhY2sucHVzaChbImwiLCBfXSk7CgkJCWV2ZW50c1N0YWNrUHRyKys7CgkJCWlmIChldmVudHNTdGFjay5sZW5ndGggPiBldmVudHNTdGFja1B0cikgZXZlbnRzU3RhY2subGVuZ3RoID0gZXZlbnRzU3RhY2tQdHI7CgkJCXBvbHkubGFzdENhbnZhc1VwZGF0ZSA9IGN1cnJlbnRDYW52YXNVcGRhdGU7CgkJCWZvciAoY29uc3QgcG9seTIgb2YgcG9seS5jb25uZWN0aW9ucykgewoJCQkJaWYgKHBvbHkyKSBwb2x5Mi5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQkJfQoJCQlicmVhazsKCQl9Cgl9Cglldi5wcmV2ZW50RGVmYXVsdCgpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCAoZXYpID0+IHsKCWlmIChnYW1lLndvbiB8fCAhZXYuY3RybEtleSkgcmV0dXJuOwoJaWYgKGV2LmtleSA9PT0gInoiKSB7CgkJaWYgKCFldmVudHNTdGFja1B0cikgcmV0dXJuOwoJCWV2ZW50c1N0YWNrUHRyLS07CgkJY29uc3QgW2UsIGtdID0gZXZlbnRzU3RhY2tbZXZlbnRzU3RhY2tQdHJdOwoJCWNvbnN0IHBvbHkgPSBnYW1lLmJvYXJkLmdldChrKTsKCQlzd2l0Y2ggKGUpIHsKCQkJY2FzZSAibCI6IHsKCQkJCXBvbHkubG9ja2VkID0gIXBvbHkubG9ja2VkOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAiY2MiOiB7CgkJCQlwb2x5LnBpcGVzUm90YXRlQ2xvY2t3aXNlKCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICJjIjogewoJCQkJcG9seS5waXBlc1JvdGF0ZUFudGljbG9ja3dpc2UoKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCXBvbHkubGFzdENhbnZhc1VwZGF0ZSA9IGN1cnJlbnRDYW52YXNVcGRhdGU7CgkJZm9yIChjb25zdCBwb2x5MiBvZiBwb2x5LmNvbm5lY3Rpb25zKSB7CgkJCWlmIChwb2x5MikgcG9seTIubGFzdENhbnZhc1VwZGF0ZSA9IGN1cnJlbnRDYW52YXNVcGRhdGU7CgkJfQoJfSBlbHNlIGlmIChldi5rZXkgPT09ICJ5IikgewoJCWlmICghZXZlbnRzU3RhY2tbZXZlbnRzU3RhY2tQdHJdKSByZXR1cm47CgkJY29uc3QgW2UsIGtdID0gZXZlbnRzU3RhY2tbZXZlbnRzU3RhY2tQdHJdOwoJCWV2ZW50c1N0YWNrUHRyKys7CgkJY29uc3QgcG9seSA9IGdhbWUuYm9hcmQuZ2V0KGspOwoJCXN3aXRjaCAoZSkgewoJCQljYXNlICJsIjogewoJCQkJcG9seS5sb2NrZWQgPSAhcG9seS5sb2NrZWQ7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICJjYyI6IHsKCQkJCXBvbHkucGlwZXNSb3RhdGVBbnRpY2xvY2t3aXNlKCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICJjIjogewoJCQkJcG9seS5waXBlc1JvdGF0ZUNsb2Nrd2lzZSgpOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJcG9seS5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQlmb3IgKGNvbnN0IHBvbHkyIG9mIHBvbHkuY29ubmVjdGlvbnMpIHsKCQkJaWYgKHBvbHkyKSBwb2x5Mi5sYXN0Q2FudmFzVXBkYXRlID0gY3VycmVudENhbnZhc1VwZGF0ZTsKCQl9Cgl9Cn0pOwo=" defer="defer"></script></head><body><div class="c-create-game"><b>Make new game</b><br><br><label for="board-type">Board type:</label><select name="board-types" id="board-type"><option value="square">Squares</option><option value="squareWrap">Squares (Wraparound)</option><option value="hexagon">Hexagons</option><option value="triangle">Triangles</option><option value="kagome">Kagome</option><option value="kagomeWrap">Kagome (Wraparound)</option><option value="octagonal">Octagonal</option><option value="dodecagonal">Dodecagonal</option></select><br><br><label for="width">Width:</label><input type="number" id="width" min="2" max="99" value="5"><label for="height">Height:</label><input type="number" id="height" min="2" max="99" value="5"><br><br><button onclick="game.makeGameFromUI()">Create!</button></div><br><label for="zoom">Zoom level:</label><input type="range" id="zoom" min="0" max="10" value="0" oninput="zoomLevel=Math.pow(1.1,Number(this.value)),initBoard()"><h2 id="win-text" style="display:none">You won!</h2><canvas id="c"></canvas></body></html>